<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini API Test & Debug</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: #0f172a;
            color: #e2e8f0;
            line-height: 1.6;
        }
        h1 { margin-bottom: 10px; color: #38bdf8; }
        .card {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        input[type="text"] {
            background: #1e293b;
            border: 1px solid #475569;
            color: #fff;
            padding: 10px;
            border-radius: 6px;
            flex-grow: 1;
            font-family: monospace;
            min-width: 250px;
        }
        button {
            background: #38bdf8;
            color: #0f172a;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        button:hover { background: #0ea5e9; transform: translateY(-1px); }
        button.secondary { background: #475569; color: #fff; }
        button.secondary:hover { background: #64748b; }
        
        pre {
            background: #020617;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
            border: 1px solid #1e293b;
            max-height: 400px;
        }
        .status { margin-top: 10px; font-weight: bold; }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .warning { color: #fbbf24; }
        
        .model-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .model-item {
            background: #1e293b;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #334155;
            cursor: pointer;
            font-size: 13px;
        }
        .model-item:hover { border-color: #38bdf8; }
        .model-item strong { display: block; margin-bottom: 4px; color: #38bdf8; }
    </style>
</head>
<body>

    <div class="card">
        <h1>ðŸ§ª Gemini API Debugger</h1>
        <p>Use this tool to verify your API key and check available models.</p>
        
        <div class="controls">
            <input type="text" id="apiKey" value="AIzaSyBwFbdKLE4U8Hw7BAnSELTMyk5b6saqJ5Q" placeholder="Enter API Key">
        </div>
        <div class="controls">
             <input type="text" id="modelName" value="gemini-2.0-flash" placeholder="Model Name (e.g. gemini-2.0-flash)">
             <button onclick="testGenerate()">Test Generate Content</button>
             <button class="secondary" onclick="listModels()">List Available Models</button>
        </div>
    </div>

    <div id="outputArea"></div>

    <script>
        // Log to page helper
        function log(message, type = 'info', data = null) {
            const out = document.getElementById('outputArea');
            let colorClass = '';
            if (type === 'success') colorClass = 'success';
            if (type === 'error') colorClass = 'error';
            
            let html = `<div class="card">
                <div class="status ${colorClass}">${type.toUpperCase()}: ${message}</div>`;
            
            if (data) {
                html += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
            html += `</div>`;
            
            // Prepend
            out.insertAdjacentHTML('afterbegin', html);
        }

        async function listModels() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) return alert('Please enter an API Key');
            
            const url = `https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`;
            
            log('Fetching available models...', 'info');
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (!response.ok) throw new Error(data.error?.message || response.statusText);
                
                log(`Found ${data.models?.length || 0} models`, 'success');
                
                // Render interactive list
                if (data.models) {
                    const listHtml = data.models.map(m => 
                        `<div class="model-item" onclick="setModel('${m.name.replace('models/', '')}')">
                            <strong>${m.name}</strong>
                            ${m.supportedGenerationMethods.join(', ')}
                        </div>`
                    ).join('');
                    
                    const out = document.getElementById('outputArea');
                    const listCard = document.createElement('div');
                    listCard.className = 'card';
                    listCard.innerHTML = `<h3>Available Models (Click to use)</h3><div class="model-list">${listHtml}</div>`;
                    out.insertBefore(listCard, out.firstChild);
                }
                
            } catch (err) {
                log(err.message, 'error', err);
            }
        }

        function setModel(name) {
            document.getElementById('modelName').value = name;
            // Highlight effect
            const input = document.getElementById('modelName');
            input.style.borderColor = '#38bdf8';
            setTimeout(() => input.style.borderColor = '#475569', 500);
        }

        async function testGenerate() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const model = document.getElementById('modelName').value.trim();
            
            if (!apiKey || !model) return alert('API Key and Model are required');
            
            // Clean model name if user pasted full path
            const cleanModel = model.replace('models/', '');
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${cleanModel}:generateContent?key=${apiKey}`;
            
            log(`Testing generation with ${cleanModel}...`, 'info');
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: 'Hello, are you working?' }] }]
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    // Specific helpful hints
                    if (response.status === 404) {
                        log('404 Not Found. This usually means the model name is incorrect or your API key does not have access to it.', 'error', data);
                        // Auto-trigger list models?
                        // listModels();
                    } else {
                        throw new Error(JSON.stringify(data, null, 2));
                    }
                    return;
                }
                
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    log('Generation Successful!', 'success', { response: text, full_data: data });
                } else {
                    log('Response received but no text found.', 'warning', data);
                }
                
            } catch (err) {
                log('Request Failed', 'error', { message: err.message });
            }
        }
    </script>
</body>
</html>
